import React, { useRef } from 'react';
import { useGSAP } from '@gsap/react';
import gsap from 'gsap';
import './AnimatedLogo.css';

// Import premium plugins
// @ts-ignore
import { DrawSVGPlugin } from 'gsap/DrawSVGPlugin';
// @ts-ignore
import { MorphSVGPlugin } from 'gsap/MorphSVGPlugin';

// Register plugins
gsap.registerPlugin(DrawSVGPlugin, MorphSVGPlugin);

interface AnimatedLogoProps {
  className?: string;
  onAnimationComplete?: () => void;
}

const AnimatedLogo: React.FC<AnimatedLogoProps> = ({ 
  className = "",
  onAnimationComplete 
}) => {
  const logoRef = useRef<SVGSVGElement>(null);
  const tlRef = useRef<gsap.core.Timeline | null>(null);

  useGSAP(() => {
    const ctx = gsap.context(() => {
      // Create a master timeline
      const masterTl = gsap.timeline({
        onComplete: () => {
          if (onAnimationComplete) onAnimationComplete();
        }
      });
      
      tlRef.current = masterTl;

      // Create individual animation timelines for more control and overlap
      const initialScaleTl = gsap.timeline();
      const lineTl = gsap.timeline();
      const lettersTl = gsap.timeline();
      const accentTl = gsap.timeline();

      // 1. Initial scale animation (starts immediately)
      initialScaleTl.fromTo(logoRef.current, {
        scale: 1.25,
        autoAlpha: 0
      }, {
        scale: 1,
        autoAlpha: 1,
        duration: 0.5,
        ease: "back.out(1.4)",
        clearProps: "scale" // Prevents scaling issues later
      });

      // Ensure all paths start invisible but keep container visible
      gsap.set(logoRef.current, { autoAlpha: 1 });
      
      // Set initial states for all elements that will animate
      gsap.set([
        ".dash-line", 
        ".dashed-path",
        ".vs-letters path"
      ], { 
        autoAlpha: 0 
      });
      
      // Set accent elements to 0 opacity but with proper scales/transforms
      gsap.set(".accent-drop", { 
        autoAlpha: 0,
        scale: 0.9,
        transformOrigin: "center center"
      });
      
      gsap.set(".accent-inner", { 
        autoAlpha: 0,
        scale: 0.8,
        transformOrigin: "center center"
      });

      // 2. Line animations (starts 0.2s after initialScale begins)
      lineTl
        // Dashed lines - make all the paths in dashed-path-group visible first
        .to(".dashed-path-group path", {
          autoAlpha: 1,
          duration: 0.05,
          ease: "none"
        })
        // Then animate them drawing on
        .fromTo(".dashed-path-group path", {
          drawSVG: "0%"
        }, {
          drawSVG: "100%",
          duration: 0.6,
          stagger: 0.03,
          ease: "power1.inOut"
        }, "-=0.05")
        
        // Diagonal line (starts while dashed lines are still animating)
        .to(".dash-line", {
          autoAlpha: 1,
          duration: 0.05,
          ease: "none"
        }, "-=0.4")
        .fromTo(".dash-line", {
          drawSVG: "0%"
        }, {
          drawSVG: "100%",
          duration: 0.5,
          ease: "power1.out"
        }, "-=0.05");

      // 3. VS letter animations (starts while lines are still animating)
      lettersTl
        .to(".vs-letters path", {
          autoAlpha: 1,
          duration: 0.05,
          ease: "none"
        }, "0.1")
        .fromTo(".vs-letters path", {
          drawSVG: "0%"
        }, {
          drawSVG: "100%",
          duration: 0.4,
          stagger: 0.1,
          ease: "power2.inOut"
        }, "-=0.05")
        
        // Pulse effect (follows immediately)
        .fromTo(".vs-letters path", { 
          filter: "brightness(1)",
          scale: 1
        }, {
          filter: "brightness(1.4)",
          scale: 1.06,
          duration: 0.25,
          yoyo: true,
          repeat: 1,
          ease: "power2.inOut"
        });

      // 4. Accent elements (fade in while letters are pulsing)
      accentTl
        // First animate the coral drop shape
        .to(".accent-drop", {
          autoAlpha: 1,
          scale: 1.1,
          duration: 0.4,
          ease: "back.out(1.2)"
        }, "0.2")
        // Then the inner cream circle with a slight delay and bounce
        .to(".accent-inner", {
          autoAlpha: 1,
          scale: 1.15, 
          duration: 0.3,
          ease: "back.out(1.4)"
        }, "0.35");
      
      // Add a little wiggle to the drop at the end
      accentTl.to(".accent-drop", {
        rotation: 5,
        duration: 0.2,
        yoyo: true,
        repeat: 1,
        ease: "power1.inOut",
        transformOrigin: "center center"
      }, "0.5");

      // Add all timelines to master timeline with increased overlaps for more fluid animation
      masterTl
        .add(initialScaleTl)
        .add(lineTl, "-=0.35") // Start lines sooner (before initial scale completes)
        .add(lettersTl, "-=0.6") // Start letters earlier (before lines complete)
        .add(accentTl, "-=0.7"); // Start accents much earlier (while letters are still drawing)

    }, logoRef);

    return () => ctx.revert(); // Proper cleanup
  }, [onAnimationComplete]);

  return (
    <div className={`relative ${className}`}>
      <svg 
        ref={logoRef}
        width="670" 
        height="890" 
        viewBox="0 0 670 890" 
        fill="none" 
        xmlns="http://www.w3.org/2000/svg"
        className="w-full h-auto"
      >
        {/* Outer dashed lines */}
        <g className="dashed-path-group">
          <path d="M68.1099 725.193C68.1841 725.459 68.46 725.614 68.726 725.54L73.0612 724.33C73.3272 724.256 73.4827 723.98 73.4084 723.714C73.3342 723.448 73.0584 723.293 72.7924 723.367L68.9389 724.442L67.8639 720.59C67.7896 720.324 67.5138 720.169 67.2478 720.243C66.9818 720.318 66.8263 720.593 66.9005 720.859L68.1099 725.193ZM459.207 33.0228C459.133 32.7569 458.857 32.6015 458.591 32.6757L454.256 33.8856C453.99 33.9598 453.835 34.2356 453.909 34.5015C453.983 34.7675 454.259 34.9229 454.525 34.8486L458.378 33.7732L459.453 37.6252C459.528 37.8912 459.803 38.0466 460.069 37.9723C460.335 37.8981 460.491 37.6223 460.417 37.3564L459.207 33.0228ZM458.29 32.9118L457.305 34.659L458.176 35.1499L459.161 33.4026L458.29 32.9118ZM453.364 41.6479L451.394 45.1424L452.265 45.6332L454.235 42.1388L453.364 41.6479ZM447.453 52.1313L445.483 55.6257L446.354 56.1166L448.324 52.6221L447.453 52.1313ZM441.542 62.6146L439.571 66.1091L440.443 66.5999L442.413 63.1055L441.542 62.6146ZM435.631 73.098L433.66 76.5924L434.532 77.0833L436.502 73.5888L435.631 73.098ZM429.72 83.5813L427.749 87.0758L428.62 87.5666L430.591 84.0722L429.72 83.5813ZM423.808 94.0647L421.838 97.5591L422.709 98.05L424.68 94.5555L423.808 94.0647ZM417.897 104.548L415.927 108.042L416.798 108.533L418.769 105.039L417.897 104.548ZM411.986 115.031L410.016 118.526L410.887 119.017L412.857 115.522L411.986 115.031ZM406.075 125.515L404.105 129.009L404.976 129.5L406.946 126.006L406.075 125.515ZM400.164 135.998L398.194 139.493L399.065 139.983L401.035 136.489L400.164 135.998ZM394.253 146.481L392.282 149.976L393.154 150.467L395.124 146.972L394.253 146.481ZM388.342 156.965L386.371 160.459L387.243 160.95L389.213 157.456L388.342 156.965ZM382.431 167.448L380.46 170.943L381.331 171.433L383.302 167.939L382.431 167.448ZM376.519 177.931L374.549 181.426L375.42 181.917L377.391 178.422L376.519 177.931ZM370.608 188.415L368.638 191.909L369.509 192.4L371.48 188.906L370.608 188.415ZM364.697 198.898L362.727 202.393L363.598 202.883L365.568 199.389L364.697 198.898ZM358.786 209.382L356.816 212.876L357.687 213.367L359.657 209.872L358.786 209.382ZM352.875 219.865L350.905 223.359L351.776 223.85L353.746 220.356L352.875 219.865ZM346.964 230.348L344.993 233.843L345.865 234.334L347.835 230.839L346.964 230.348ZM341.053 240.832L339.082 244.326L339.954 244.817L341.924 241.322L341.053 240.832ZM335.142 251.315L333.171 254.809L334.042 255.3L336.013 251.806L335.142 251.315ZM329.23 261.798L327.26 265.293L328.131 265.784L330.102 262.289L329.23 261.798ZM323.319 272.282L321.349 275.776L322.22 276.267L324.191 272.773L323.319 272.282ZM317.408 282.765L315.438 286.26L316.309 286.75L318.279 283.256L317.408 282.765ZM311.497 293.248L309.527 296.743L310.398 297.234L312.368 293.739L311.497 293.248ZM305.586 303.732L303.616 307.226L304.487 307.717L306.457 304.223L305.586 303.732ZM299.675 314.215L297.704 317.71L298.576 318.2L300.546 314.706L299.675 314.215ZM293.764 324.698L291.793 328.193L292.665 328.684L294.635 325.189L293.764 324.698ZM287.853 335.182L285.882 338.676L286.753 339.167L288.724 335.673L287.853 335.182ZM281.942 345.665L279.971 349.16L280.842 349.65L282.813 346.156L281.942 345.665ZM276.03 356.148L274.06 359.643L274.931 360.134L276.902 356.639L276.03 356.148ZM270.119 366.632L268.149 370.126L269.02 370.617L270.991 367.123L270.119 366.632ZM264.208 377.115L263.223 378.862L264.094 379.353L265.079 377.606L264.208 377.115ZM263.223 378.862L262.238 380.61L263.109 381.1L264.094 379.353L263.223 378.862ZM258.297 387.599L256.327 391.093L257.198 391.584L259.168 388.089L258.297 387.599ZM252.386 398.082L250.416 401.576L251.287 402.067L253.257 398.573L252.386 398.082ZM246.475 408.565L244.504 412.06L245.376 412.551L247.346 409.056L246.475 408.565ZM240.564 419.049L238.593 422.543L239.465 423.034L241.435 419.539L240.564 419.049ZM234.653 429.532L232.682 433.026L233.553 433.517L235.524 430.023L234.653 429.532ZM228.741 440.015L226.771 443.51L227.642 444.001L229.613 440.506L228.741 440.015ZM222.83 450.499L220.86 453.993L221.731 454.484L223.702 450.989L222.83 450.499ZM216.919 460.982L214.949 464.476L215.82 464.967L217.79 461.473L216.919 460.982ZM211.008 471.465L209.038 474.96L209.909 475.451L211.879 471.956L211.008 471.465ZM205.097 481.949L203.127 485.443L203.998 485.934L205.968 482.44L205.097 481.949ZM199.186 492.432L197.215 495.926L198.087 496.417L200.057 492.923L199.186 492.432ZM193.275 502.915L191.304 506.41L192.176 506.901L194.146 503.406L193.275 502.915ZM187.364 513.399L185.393 516.893L186.264 517.384L188.235 513.89L187.364 513.399ZM181.452 523.882L179.482 527.377L180.353 527.867L182.324 524.373L181.452 523.882ZM175.541 534.365L173.571 537.86L174.442 538.351L176.413 534.856L175.541 534.365ZM169.63 544.849L167.66 548.343L168.531 548.834L170.501 545.34L169.63 544.849ZM163.719 555.332L161.749 558.827L162.62 559.317L164.59 555.823L163.719 555.332ZM157.808 565.815L155.838 569.31L156.709 569.801L158.679 566.306L157.808 565.815ZM151.897 576.299L149.926 579.793L150.798 580.284L152.768 576.79L151.897 576.299ZM145.986 586.782L144.015 590.277L144.887 590.768L146.857 587.273L145.986 586.782ZM140.075 597.266L138.104 600.76L138.976 601.251L140.946 597.756L140.075 597.266ZM134.163 607.749L132.193 611.243L133.064 611.734L135.035 608.24L134.163 607.749ZM128.252 618.232L126.282 621.727L127.153 622.218L129.124 618.723L128.252 618.232ZM122.341 628.716L120.371 632.21L121.242 632.701L123.212 629.206L122.341 628.716ZM116.43 639.199L114.46 642.693L115.331 643.184L117.301 639.69L116.43 639.199ZM110.519 649.682L108.549 653.177L109.42 653.668L111.39 650.173L110.519 649.682ZM104.608 660.166L102.637 663.66L103.509 664.151L105.479 660.657L104.608 660.166ZM98.6968 670.649L96.7264 674.144L97.5976 674.634L99.568 671.14L98.6968 670.649ZM92.7856 681.132L90.8152 684.627L91.6865 685.118L93.6569 681.623L92.7856 681.132ZM86.8745 691.616L84.9041 695.11L85.7754 695.601L87.7458 692.107L86.8745 691.616ZM80.9634 702.099L78.993 705.594L79.8643 706.084L81.8346 702.59L80.9634 702.099ZM75.0523 712.582L73.0819 716.077L73.9531 716.568L75.9235 713.073L75.0523 712.582ZM69.1412 723.066L68.156 724.813L69.0272 725.304L70.0124 723.557L69.1412 723.066Z" 
          fill="[var(--secondary-200)]" className="dashed-path text-[--secondary-teal] dark:text-[--secondary-teal-hover]" />
        </g>
        <g className="dashed-path-group">
          <path d="M216.918 120.271C217.113 120.076 217.113 119.759 216.918 119.564L213.736 116.382C213.541 116.187 213.224 116.187 213.029 116.382C212.834 116.577 212.834 116.894 213.029 117.089L215.857 119.917L213.029 122.746C212.834 122.941 212.834 123.258 213.029 123.453C213.224 123.648 213.541 123.648 213.736 123.453L216.918 120.271ZM216.564 119.417H214.575V120.417H216.564V119.417ZM206.618 119.417H202.639V120.417H206.618V119.417ZM194.682 119.417H190.703V120.417H194.682V119.417ZM182.746 119.417H178.767V120.417H182.746V119.417ZM170.81 119.417H166.831V120.417H170.81V119.417ZM158.874 119.417H154.896V120.417H158.874V119.417ZM146.938 119.417H142.96V120.417H146.938V119.417ZM135.002 119.417H131.024V120.417H135.002V119.417ZM123.066 119.417H119.088V120.417H123.066V119.417ZM111.13 119.417H107.152V120.417H111.13V119.417ZM99.1945 119.417H95.2159V120.417H99.1945V119.417ZM87.2586 119.417H83.2799V120.417H87.2586V119.417ZM75.3227 119.417H71.344V120.417H75.3227V119.417ZM63.3867 119.417H59.4081V120.417H63.3867V119.417ZM51.4508 119.417H47.4722V120.417H51.4508V119.417ZM39.5149 119.417H35.5362V120.417H39.5149V119.417ZM27.5789 119.417H23.6003V120.417H27.5789V119.417ZM15.643 119.417H11.6644V120.417H15.643V119.417ZM3.70709 119.417H-0.271548V120.417H3.70709V119.417ZM-8.22884 119.417H-10.2181V120.417H-8.22884V119.417ZM-10.2181 119.417H-12.2075V120.417H-10.2181V119.417ZM-20.1648 119.417H-24.1434V120.417H-20.1648V119.417ZM-32.1007 119.417H-36.0793V120.417H-32.1007V119.417ZM-44.0366 119.417H-48.0152V120.417H-44.0366V119.417ZM-55.9725 119.417H-59.9512V120.417H-55.9725V119.417ZM-67.9085 119.417H-71.8871V120.417H-67.9085V119.417ZM-79.8444 119.417H-83.823V120.417H-79.8444V119.417ZM-91.7803 119.417H-95.759V120.417H-91.7803V119.417ZM-103.716 119.417H-107.695V120.417H-103.716V119.417ZM-115.652 119.417H-119.631V120.417H-115.652V119.417ZM-127.588 119.417H-131.567V120.417H-127.588V119.417ZM-139.524 119.417H-143.503V120.417H-139.524V119.417ZM-151.46 119.417H-155.439V120.417H-151.46V119.417ZM-163.396 119.417H-167.375V120.417H-163.396V119.417ZM-175.332 119.417H-179.31V120.417H-175.332V119.417ZM-187.268 119.417H-191.246V120.417H-187.268V119.417ZM-199.204 119.417H-203.182V120.417H-199.204V119.417ZM-211.14 119.417H-215.118V120.417H-211.14V119.417ZM-223.076 119.417H-227.054V120.417H-223.076V119.417ZM-235.011 119.417H-237.001V120.417H-235.011V119.417Z" 
          fill="[var(--secondary-200)]" className="dashed-path text-[--secondary-teal] dark:text-[--secondary-teal-hover]" />
        </g>
        <g className="dashed-path-group">
          <path d="M112.906 73.1757C112.711 72.9805 112.394 72.9805 112.199 73.1757L109.017 76.3577C108.821 76.553 108.821 76.8696 109.017 77.0648C109.212 77.2601 109.529 77.2601 109.724 77.0648L112.552 74.2364L115.381 77.0648C115.576 77.2601 115.893 77.2601 116.088 77.0648C116.283 76.8696 116.283 76.553 116.088 76.3577L112.906 73.1757ZM112.052 73.5293L112.052 75.4706L113.052 75.4706L113.052 73.5293L112.052 73.5293ZM112.052 83.2356L112.052 87.1181L113.052 87.1181L113.052 83.2356L112.052 83.2356ZM112.052 94.8831L112.052 98.7656L113.052 98.7656L113.052 94.8831L112.052 94.8831ZM112.052 106.531L112.052 108.472L113.052 108.472L113.052 106.531L112.052 106.531ZM112.052 108.472L112.052 110.413L113.052 110.413L113.052 108.472L112.052 108.472ZM112.052 118.178L112.052 122.061L113.052 122.061L113.052 118.178L112.052 118.178ZM112.052 129.826L112.052 133.708L113.052 133.708L113.052 129.826L112.052 129.826ZM112.052 141.473L112.052 143.415L113.052 143.415L113.052 141.473L112.052 141.473Z" 
          fill="[var(--secondary-200)]" className="dashed-path text-[--secondary-teal] dark:text-[--secondary-teal-hover]" />
        </g>
        <g className="dashed-path-group">
          <path d="M157.082 625.887C156.887 626.082 156.887 626.399 157.082 626.594L160.264 629.776C160.459 629.971 160.776 629.971 160.971 629.776C161.167 629.581 161.167 629.264 160.971 629.069L158.143 626.24L160.971 623.412C161.167 623.217 161.167 622.9 160.971 622.705C160.776 622.509 160.459 622.509 160.264 622.705L157.082 625.887ZM550.214 625.74H548.168V626.74H550.214V625.74ZM539.985 625.74H535.894V626.74H539.985V625.74ZM527.711 625.74H523.62V626.74H527.711V625.74ZM515.437 625.74H511.345V626.74H515.437V625.74ZM503.162 625.74H499.071V626.74H503.162V625.74ZM490.888 625.74H486.797V626.74H490.888V625.74ZM478.614 625.74H474.522V626.74H478.614V625.74ZM466.339 625.74H462.248V626.74H466.339V625.74ZM454.065 625.74H449.974V626.74H454.065V625.74ZM441.791 625.74H437.699V626.74H441.791V625.74ZM429.516 625.74H425.425V626.74H429.516V625.74ZM417.242 625.74H413.151V626.74H417.242V625.74ZM404.968 625.74H400.876V626.74H404.968V625.74ZM392.693 625.74H388.602V626.74H392.693V625.74ZM380.419 625.74H376.328V626.74H380.419V625.74ZM368.145 625.74H364.053V626.74H368.145V625.74ZM355.871 625.74H353.825V626.74H355.871V625.74ZM353.825 625.74H351.779V626.74H353.825V625.74ZM343.596 625.74H339.505V626.74H343.596V625.74ZM331.322 625.74H327.23V626.74H331.322V625.74ZM319.048 625.74H314.956V626.74H319.048V625.74ZM306.773 625.74H302.682V626.74H306.773V625.74ZM294.499 625.74H290.408V626.74H294.499V625.74ZM282.225 625.74H278.133V626.74H282.225V625.74ZM269.95 625.74H265.859V626.74H269.95V625.74ZM257.676 625.74H253.585V626.74H257.676V625.74ZM245.402 625.74H241.31V626.74H245.402V625.74ZM233.127 625.74H229.036V626.74H233.127V625.74ZM220.853 625.74H216.762V626.74H220.853V625.74ZM208.579 625.74H204.487V626.74H208.579V625.74ZM196.304 625.74H192.213V626.74H196.304V625.74ZM184.03 625.74H179.939V626.74H184.03V625.74ZM171.756 625.74H167.664V626.74H171.756V625.74ZM159.481 625.74H157.436V626.74H159.481V625.74Z" 
          fill="[var(--secondary-200)]" className="dashed-path text-[--secondary-teal] dark:text-[--secondary-teal-hover]" />
        </g>
        
        {/* The main diagonal line */}
        <path className="dash-line" 
          d="M153.28 574.277L161.155 572.075L158.96 564.223L151.084 566.426L153.28 574.277ZM392.914 150.134L382.96 156.016L393.03 161.665L392.914 150.134ZM156.992 569.739L275.389 360.181L273.645 359.203L155.248 568.761L156.992 569.739ZM275.389 360.181L389.359 158.459L387.615 157.481L273.645 359.203L275.389 360.181Z" 
          fill="[var(--secondary-200)]"  />
        
        {/* VS letters in one group for unified animation */}
        <g className="vs-letters">
          {/* V path */}
          <path d="M121.401 143.415L154.636 231.936L138.756 231.936L113.852 159.161L113.504 159.161L88.5132 231.936L72.807 231.936L105.955 143.415L121.401 143.415Z" 
                fill="[var(--secondary-400)]"  />
          
          {/* S path */}
          <path d="M381.518 541.306C307.247 541.306 251.322 505.281 296.463 476.261L246.845 465.156H263.259L313.091 476.261C267.949 496.833 317.266 526.945 381.305 526.945C419.462 526.945 445.469 508.15 445.469 480.907V480.696C445.469 457.254 431.613 445.217 396.013 436.98L365.104 429.8C322.896 420.086 303.498 402.98 303.498 374.259V374.047C303.498 339.202 335.047 314.493 378.96 314.493C424.365 314.493 453.995 340.469 458.472 379.538L458.685 381.439H442.697L442.484 379.961C438.221 349.128 414.346 328.854 378.96 328.854C344.426 328.854 320.125 347.649 320.125 373.836V374.047C320.125 394.955 334.407 407.203 370.007 415.44L400.916 422.62C444.403 432.757 462.309 449.44 462.309 479.851V480.062C462.309 516.175 428.628 541.306 381.518 541.306Z" 
                fill="[var(--secondary-200)]" />
        </g>
        
        {/* Accent elements */}
        <g className="accent-elements">
          {/* Accent drop shape (coral) */}
          <path 
            className="accent-drop"
            d="M285.875 437.104C285.875 428.366 293.235 421.327 302.371 421.327C311.507 421.327 318.867 428.366 318.867 437.104C318.867 450.833 307.87 464.998 302.371 476.113C296.873 466.483 285.875 450.833 285.875 437.104Z" 
            fill="#DE6B59"
          />
          
          {/* Inner circle (cream) */}
          <path 
            className="accent-inner"
            d="M294.124 437.763C294.124 433.211 297.803 429.545 302.371 429.545C306.939 429.545 310.619 433.211 310.619 437.763C310.619 442.314 306.939 445.981 302.371 445.981C297.803 445.981 294.124 442.314 294.124 437.763Z" 
            fill="#FDEBDD"
          />
        </g>
      </svg>
    </div>
  );
};

export default AnimatedLogo;